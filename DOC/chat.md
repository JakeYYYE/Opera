# 项目沟通与决策记录 (Chat Context)

本文档用于归纳开发过程中的核心讨论、产品决策及业务逻辑梳理，以便于后续任务的上下文管理。

## 2026-01-13：用户管理与商业闭环设计

### 1. 核心议题
如何构建后台管理系统，以支持**C端用户向小B端商户的转化**，并明确“需求大厅”在其中的战略地位。

### 2. 业务逻辑梳理 (C -> B Conversion)

#### 用户分层模型
*   **C端用户 (Novice / 小白)**：
    *   **画像**：拥有无人机，主要用于娱乐，无商业经验。
    *   **角色**：流量底座，潜在运力。
    *   **痛点**：不知道如何变现，缺乏安全指引。
*   **进阶飞手 (Advanced / 核心运力)**：
    *   **画像**：通过平台认证，有作品集，有飞行经验。
    *   **角色**：平台的主要接单方（服务提供者）。
    *   **权益**：可接取商业级订单 (Lv2)。
*   **小B端商户 (Small B)**：
    *   **画像**：航拍工作室、婚庆公司、保险机构。
    *   **角色**：
        *   **需求方**：发布拍摄订单。
        *   **服务方**：提供培训、保险服务。

#### 转化路径设计
*   **诱饵**：“需求大厅”中的高价值订单。
*   **触发**：小白用户点击“接单” -> 系统检测资质不足 -> 触发“飞手认证”流程。
*   **落地**：后台新增“C端用户管理”模块，运营人员审核用户提交的认证申请（飞行时长、作品、实名信息）。
*   **结果**：审核通过 -> 用户身份升级为“进阶飞手” -> 解锁接单权限。

### 3. 任务分级体系 (Quest Level System)

为了匹配不同层级的运力，需求大厅的任务将实行**三级分层**：

| 等级 | 名称 | 适用人群 | 典型场景 | 接单门槛 | 核心价值 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **Lv1** | **新手任务** | C端小白 | 找猫、看屋顶、拍夕阳 | **低** (实名即可) | 激活C端活跃度，赚零花钱 |
| **Lv2** | **进阶任务** | 进阶飞手 | 民宿宣传片、婚礼跟拍 | **中** (需认证+保险) | 商业变现主力，平台抽佣核心 |
| **Lv3** | **专业任务** | 企业/B端 | 电网巡检、测绘、农林植保 | **高** (需企业资质) | 树立行业标杆，B端获客 |

### 4. 系统落地情况

#### 已完成 (Code Implemented)
*   **数据源**：`src/data/mockUsers.js` (定义了Novice, Advanced, Small B三类用户结构)。
*   **C端管理页**：`src/views/AdminUserCManage.vue` (实现了列表筛选及**飞手认证审核**功能)。
*   **小B端管理页**：`src/views/AdminUserSmallBManage.vue` (实现了商户列表及状态管理)。
*   **路由配置**：`router/index.js` 及 `AdminLayout.vue` 已更新，新增“用户管理”菜单。

#### 待规划 (Next Steps)
*   **需求大厅改造**：前端需根据任务等级 (Lv1/Lv2/Lv3) 展示不同的UI标签及接单限制。
*   **认证前端入口**：在C端个人中心或接单拦截页，增加“申请成为飞手”的入口。
*   **撮合算法**：针对不同等级任务实现不同的分发逻辑 (抢单 vs 派单 vs 竞标)。

---

## 2026-01-13 16:00：身份切换与品牌升级 (Identity & Branding)

### 1. 核心议题
优化用户身份切换体验，并统一全平台品牌名称以符合最新产品定位。

### 2. 身份切换逻辑 (Identity Switching)
*   **同端内双向切换**:  
    *   B 端账号：仅在“企业服务方 ↔ 企业需求方”之间切换，不允许切到任何 C 端身份。  
    *   C 端账号：仅在“个人服务方 ↔ 个人需求方”之间切换，不允许切到任何 B 端身份。
*   **智能判断**:
    *   若用户已拥有目标身份能力（已完成对应认证/补充资料），弹出确认框提示“切换需要重新登录”，确认后执行退出并回到登录入口。
    *   若用户未拥有目标身份能力，则打开对应端内的申请表单（企业资质 / 个人飞手 / 个人需求方补充信息），完成后再进入可切换状态（Lazy Registration）。
*   **UI表现**:
    *   顶部导航栏显式展示当前身份（如“企业服务方”“个人需求方”），标签文案随当前账号端与活跃身份变化。
    *   切换入口统一放在头像下拉菜单中，文案根据端类型显示为“切换为企业服务方/企业需求方”或“切换为个人服务方/个人需求方”。

### 3. 品牌名称升级 (Rebranding)
*   **智慧飞滴 (Smart Fly Drop)**: 原“服务平台”，定位为核心运营撮合平台。
*   **飞行地图 (Flight Map)**: 原“去哪拍”，定位为C端流量入口工具。
*   **同步范围**: 已覆盖 `PRD.md`、`飞行地图PRD.md` 及所有前端核心视图 (`Home.vue`, `AdminLayout.vue` 等)。

### 4. 系统落地情况
*   **代码**: `useAuth.js` (身份逻辑), `Home.vue` (交互入口), `AdminLayout.vue` (品牌展示)。
*   **文档**: 所有PRD文档已完成术语替换。

## 2026-01-14：冷启动引流与新闻模块落地

### 1. 核心议题
*   新闻引流优先，联动首页与资讯列表/详情，统一数据源与路由。

### 2. 决策与改动
*   统一数据源为 `useMockData.js`，新增 ID 6–12 文章，采用 HTML 段落排版（提升详情页阅读体验）。
*   新增前台路由 `/news` 与 `/news/:id`，创建 `NewsList.vue`、`NewsDetail.vue`，Navbar 增加「行业资讯」。
*   首页新闻卡片支持点击直达详情，「查看更多」跳转列表；按 `publishTime` 倒序取最新 3 条。
*   列表页支持分类筛选与按时间倒序；侧栏提供热门推荐（按 `views` 排序 Top5）。

### 3. 修复
*   `useMockData.js` 解析错误（误将 `news` 嵌入 `providers`）已更正，并加入本地存储迁移逻辑。

### 4. 交互体验优化 (UX Improvements)
*   **飞行地图 (FindSpot)**:
    *   **痛点**: 用户在点击“创建航拍点”后，如果没有选点意图，无法快速退出该模式，必须重新点击按钮或刷新。
    *   **优化**: 新增右键交互逻辑。在 `createSpotMode` (创建模式) 下，点击鼠标右键将直接重置模式为 `false`，并恢复地图默认光标与交互状态。
    *   **新增**: 地图中的公共推荐点与用户航拍点在 Marker 上使用首张照片作为圆形缩略图图标，点击 Marker 或列表卡片时通过当前页弹窗查看详情，而非跳转独立详情页。

*   **登录与注册入口 (Auth Entry UI)**:
    *   **决策**: 统一 Navbar 右侧“登录 / 注册”入口与登录弹窗主按钮的 UI 风格，采用品牌化蓝色渐变、圆角和轻量阴影，以贴合整体视觉设计。
    *   **注册角色选择**: 在注册弹窗中新增卡片式角色选择组件，区分“我要发需求”和“我是服务商”，默认需求方；后续可在“身份中心”完善和切换身份。该选择结果会记录在用户信息中并用于初始化活跃身份。

---

## 2026-01-14 17:00：移动端适配与核心流程体验优化

### 1. 核心议题
*   在不拆分 H5 / 小程序版本的前提下，通过响应式改造让核心业务流程在手机端具备可用且相对舒适的体验。
*   明确哪些页面需要“只读适配”（不严重错位即可），哪些页面需要“交互级适配”（列表、表格、弹窗的交互模式要做重构）。

### 2. 重点页面与改动摘要

*   **消息中心 (`Messages.vue`)**
    *   桌面端保持“左侧列表 + 右侧详情”的双栏布局。
    *   移动端改造为“消息列表视图 / 会话详情视图”双视图切换：
        *   默认进入列表视图，点击某条消息后进入详情视图。
        *   详情头部新增“返回列表”按钮，方便在多个会话间切换。
    *   聊天气泡与报价方案（plan_proposal）卡片针对小屏缩减左右边距与字体大小，避免一屏只能看到 1–2 条消息。
    *   底部输入区增加安全区适配（safe area），在全面屏 / 手势导航设备上不被系统手势栏遮挡。
    *   消息列表增加未读红点标识（基于 `msg.unread` 字段）。

*   **服务侧：我的任务 (`ProviderTasks.vue`)**
    *   桌面端：
        *   继续使用 `el-table` 展示任务名称、需求方、成交价、状态、截止日期与操作列。
    *   移动端：
        *   将表格拆解为任务卡片列表，卡片内聚合展示标题、需求方、成交价、截止日期与状态。
        *   操作逻辑按状态分支：
            *   状态为“已通过”→ 卡片底部提供“提交成果 + 联系对方”按钮。
            *   其他状态 → 提供“查看详情 + 联系对方”按钮。

*   **需求侧：我的需求 (`RequesterNeeds.vue`)**
    *   桌面端：
        *   保留表格视图，字段包含需求标题、类型、预算、状态、发布时间与操作列。
    *   移动端：
        *   使用卡片形式展示需求：
            *   顶部：标题 + 状态标签。
            *   中部：类型标签 + 预算信息。
            *   底部：发布时间 + “查看详情 / 撤销”操作按钮。
        *   顶部“发布需求”入口在移动端收缩为圆形图标按钮，桌面端保持文字按钮以强调入口。

*   **服务能力：我的服务能力 (`ProviderServices.vue`)**
    *   桌面端：
        *   沿用原有服务能力卡片布局。
        *   底部“编辑 / 上架/下架”操作在 hover 时出现，保持列表视觉干净。
    *   移动端：
        *   顶部“发布新服务”入口改为圆形图标按钮，减少在窄屏上的横向占用。
        *   卡片底部的操作按钮默认展示，不再依赖 hover 行为（移动端没有悬浮态）。

*   **后台：首页推荐管理 (`AdminNewsFeatured.vue`)**
    *   推荐位预览区域：
        *   使用响应式栅格调整卡片间距，在手机端保持单列展示。
        *   将原本依赖 hover 显示的“更换内容”按钮改为卡片右下角的圆形编辑按钮，在移动端始终可见。
    *   选择弹窗：
        *   弹窗宽度在移动端收缩为约 95% 视口宽度。
        *   桌面端保留表格筛选 + 高亮当前选中行；移动端改为可滚动的新闻卡片列表，点击整卡即可选择。

### 3. 设计共识与技术实现要点

*   **布局策略**
    *   全面采用 Tailwind CSS 断点类（如 `md:hidden` / `hidden md:block`）区分桌面与移动端展示。
    *   面向数据密集型页面（任务、需求等），桌面优先表格；移动端优先卡片，字段精简为“标题 + 2–3 个关键属性 + 状态 + 主操作”。

*   **交互模式**
    *   列表 → 详情型流程在移动端统一采用“先列表后详情”的单列导航模式，并提供显式返回入口。
    *   与交易强相关的操作（提交成果 / 撤销 / 联系对方等）在移动端必须落在卡片底部或底部操作条中，避免被横向滚动或系统手势遮挡。

*   **验收标准**
    *   以 375px 视口宽度作为基准，所有上述页面不出现横向滚动条。
    *   核心字段在一屏内可阅读，主要操作按钮不需要放大缩放或精确点击才可触发。
    *   消息输入区、Navbar 等关键区域在主流全面屏设备上不与系统手势区冲突。

## 2026-01-15：用户架构调整与接单权限重构

### 1. 核心议题
*   简化用户层级体系，不再强制“一号通”逻辑，改为需重新登录切换身份。
*   明确不同身份的接单/发单权限边界。

### 2. 决策与改动
*   **用户层级 (User Tiers)**:
    *   **基础飞手 (Novice)**: C端普通用户。仅可发布个人需求，**不可接单**。
    *   **认证飞手 (Advanced)**: C端认证用户。可发布个人需求，**可接单**（暂不限制任务等级）。
    *   **服务商 (Provider)**: B端企业用户。可发布企业/个人需求，**可接全部订单**（B端+C端）。
*   **身份切换 (Identity Switch)**:
    *   废弃“会话内直接切换身份”的逻辑。
    *   点击“切换身份”时，触发**注销并重新登录**流程，引导用户使用不同账号（或同一手机号下的不同角色账号）登录。
*   **权限控制 (Access Control)**:
    *   `ServiceNeedDetail.vue`: 增加权限拦截。
        *   若为普通C端用户，点击“接单”提示需认证或升级。
        *   若为认证C端用户，进入“快捷接单”模式（仅填报价/描述）。
        *   若为服务商，进入“专业接单”模式（需选飞手/设备/传方案）。
*   **配额修正**:
    *   发布需求配额锁定为 **999**，且发布时不扣减（临时策略）。
    *   修复“发布需求”按钮未正确跳转的问题。

### 3. 代码落地
*   `useAuth.js`: 移除登录时的强制等级覆盖逻辑，完全尊重 `mockUsers` 的初始状态。

## 2026-01-15 17:30：后台管理优化与注册体验增强

### 1. 核心议题
*   优化后台用户管理的视觉体验（菜单命名、标签展示）。
*   完善 C 端向 B 端升级的审核闭环（查看详情）。
*   在注册环节前置捕获用户身份意图。

### 2. 决策与改动
*   **后台体验优化**:
    *   **菜单统一**: 将 `AdminSideMenu` 中的 "C端用户" 更名为 "C端用户管理"，与 "B端用户管理" 保持一致。
    *   **标签简化**: 在用户管理列表中，不再展示 "个人需求方/企业需求方/认证飞手" 等组合标签，统一简化为 **"需求方"** 和 **"服务方"** 两个原子标签，降低视觉噪点。
*   **注册流程 (Registration)**:
    *   在注册弹窗 (`LoginModal.vue`) 中增加显式的身份选择卡片："我是需求方" vs "我是服务方"。
    *   注册逻辑 (`useAuth.js`) 根据用户选择设置初始状态：选择 "服务方" 则自动赋予 `providerLevel: 'lv1'`，减少后续认证步骤。
*   **C-to-B 升级审核**:
    *   在 C 端用户管理的 "升级申请" 列表中，增加 **"详情"** 按钮。
    *   实现详情弹窗，展示企业名称、业务类型、联系人信息，并支持预览飞手资质证书与保险凭证文件。
    *   在详情弹窗内集成 "通过" 与 "驳回" 操作，提升审核效率。

### 3. 代码落地
*   `AdminSideMenu.vue`: 菜单文案更新。
*   `AdminUserCManage.vue`: 身份标签逻辑重构，新增 `upgradeDetailVisible` 弹窗相关逻辑。
*   `AdminUserSmallBManage.vue`: 身份标签逻辑同步简化。
*   `LoginModal.vue`: 新增 `registerIdentity` 状态与 UI 选择器。
*   `useAuth.js`: 注册方法适配 `registerIdentity` 参数。
*   `ServiceNeedDetail.vue`: 实现上述权限拦截与模式分发逻辑。
*   `IdentityDialog.vue` / `Navbar.vue`: 适配“重新登录”的切换交互。
