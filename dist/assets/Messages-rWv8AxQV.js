import{u as se,r as w,o as W,a as le,c as g,b as oe,d as ae,e as i,f as q,g as f,h as s,i as l,_ as ne,n as p,w as d,j as m,F as z,k as N,t as a,l as ie,m as de,p as n,q as c,s as P,v as re,x as ue,E as M}from"./index-U0bzlslD.js";const ce={key:0,class:"mb-4 md:mb-6 px-4 pt-4 md:pt-0"},pe={class:"p-4 border-b border-gray-100 flex justify-between items-center bg-gray-50 md:bg-white"},me={class:"overflow-y-auto flex-1"},ve=["onClick"],xe={class:"flex justify-between items-start mb-1"},fe={class:"font-bold text-gray-800 text-sm"},ye={class:"text-xs text-gray-400"},ge={class:"text-sm text-gray-600 line-clamp-1 pr-4"},be={key:0,class:"absolute right-4 top-1/2 -translate-y-1/2 w-2 h-2 rounded-full bg-red-500"},_e={class:"p-4 md:p-6 border-b border-gray-100 bg-white sticky top-0 z-10"},we={class:"flex items-center gap-2 mb-2 md:hidden"},he={class:"flex justify-between items-start"},ke={class:"flex-1 min-w-0 mr-2"},Ve={class:"font-bold text-lg md:text-xl text-gray-800 mb-1 truncate"},Ce={class:"flex items-center gap-2 text-xs md:text-sm text-gray-500"},Te={key:0,class:"flex-1 flex flex-col bg-gray-50 overflow-hidden relative"},ze={class:"flex-1 overflow-y-auto p-3 md:p-4 space-y-4"},Me={key:1,class:"bg-white rounded-lg shadow-sm border border-blue-100 overflow-hidden w-full max-w-xs text-left"},je={class:"bg-blue-50 px-3 py-2 border-b border-blue-100 flex justify-between items-center"},Ee={class:"font-bold text-blue-800 text-sm"},$e={class:"p-3 space-y-2"},De={class:"flex justify-between items-center"},Le={class:"text-lg font-bold text-red-500"},Ue={class:"flex justify-between items-center"},We={class:"text-sm text-gray-800"},qe={key:0,class:"bg-gray-50 rounded p-2 text-xs text-gray-600"},Ne={class:"mb-1"},Pe={key:1,class:"bg-gray-50 rounded p-2 text-xs text-gray-600"},Ae={class:"text-xs text-gray-600 bg-gray-50 p-2 rounded line-clamp-3"},Be={key:2,class:"pt-2"},Re={class:"text-xs text-gray-400 mt-1"},Fe={class:"p-3 md:p-4 bg-white border-t border-gray-100 flex gap-2 items-center safe-area-bottom"},Se={key:1,class:"p-4 md:p-8 flex-1 overflow-y-auto"},Ie={class:"prose max-w-none text-gray-700 text-sm md:text-base"},Ke={key:0,class:"mt-6 md:mt-8"},Ge={key:1,class:"flex-1 flex flex-col items-center justify-center text-gray-400 p-4"},Qe={__name:"Messages",setup(He){const A=de(),V=oe(),{activeIdentity:j}=se(),{state:B,acceptPlan:R}=ae(),E=w(window.innerWidth),$=()=>E.value=window.innerWidth;W(()=>window.addEventListener("resize",$)),le(()=>window.removeEventListener("resize",$));const h=g(()=>E.value<768),b=g(()=>V.path.startsWith("/admin")),F=g(()=>j.value==="provider"),S=g(()=>j.value.startsWith("requester")),v=w(null),y=w(""),_=w(!1),r=w({price:"",duration:"",description:""});W(()=>{V.query.id?v.value=Number(V.query.id):h.value||(v.value=4)});const I=u=>{v.value=u},D=g(()=>B.value.messages),o=g(()=>D.value.find(u=>u.id===v.value)),K=u=>{switch(u){case"system":return"info";case"transaction":return"warning";case"chat":return"success";default:return"info"}},G=u=>{switch(u){case"system":return"系统通知";case"transaction":return"交易提醒";case"chat":return"沟通消息";default:return"通知"}},H=u=>{u&&A.push(u)},L=()=>{!y.value.trim()||!o.value||o.value.type==="chat"&&(o.value.history.push({role:"me",text:y.value,time:new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),o.value.content=y.value,y.value="")},J=()=>{r.value={price:"",duration:"",description:""},_.value=!0},O=()=>{if(!r.value.price||!r.value.duration){M.warning("请填写完整的报价信息");return}o.value.history.push({role:"me",type:"plan_proposal",price:r.value.price,duration:r.value.duration,description:r.value.description,status:"pending",time:new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),o.value.content=`[报价方案] ${r.value.price}`,_.value=!1,M.success("方案已发送")},Q=(u,e)=>{R(u.id,e),M.success("已接受方案，任务状态更新为“已通过”！")};return(u,e)=>{const x=m("el-button"),U=m("el-tag"),X=m("el-avatar"),Y=m("el-tooltip"),k=m("el-input"),Z=m("el-icon"),C=m("el-form-item"),ee=m("el-form"),te=m("el-dialog");return n(),i("div",{class:p(["flex flex-col bg-gray-50 h-full",{"min-h-screen":!b.value}])},[b.value?f("",!0):(n(),q(ne,{key:0})),s("main",{class:p(["flex-grow flex flex-col",b.value?"h-full":"container mx-auto px-4 py-8 max-w-5xl"])},[b.value?f("",!0):(n(),i("div",ce,[...e[8]||(e[8]=[s("h1",{class:"text-xl md:text-2xl font-bold text-gray-800"},"消息中心",-1)])])),s("div",{class:p(["bg-white rounded-xl shadow-sm border border-gray-100 flex overflow-hidden flex-col md:flex-row",b.value?"h-full rounded-none border-0 shadow-none":"h-[calc(100vh-140px)] md:min-h-[600px]"])},[s("div",{class:p(["w-full md:w-1/3 border-r border-gray-100 flex flex-col bg-white",{"hidden md:flex":h.value&&v.value}])},[s("div",pe,[e[10]||(e[10]=s("h2",{class:"font-bold text-gray-800"},"消息列表",-1)),l(x,{link:"",type:"primary",size:"small"},{default:d(()=>[...e[9]||(e[9]=[c("全部已读",-1)])]),_:1})]),s("div",me,[(n(!0),i(z,null,N(D.value,t=>(n(),i("div",{key:t.id,class:p(["p-4 hover:bg-gray-50 cursor-pointer transition border-b border-gray-50 relative",{"bg-blue-50/50":v.value===t.id}]),onClick:T=>I(t.id)},[s("div",xe,[s("span",fe,a(t.sender),1),s("span",ye,a(t.time),1)]),s("p",ge,a(t.content),1),t.unread?(n(),i("div",be)):f("",!0)],10,ve))),128))])],2),s("div",{class:p(["flex-1 flex flex-col bg-white w-full md:w-auto",{"hidden md:flex":h.value&&!v.value}])},[o.value?(n(),i(z,{key:0},[s("div",_e,[s("div",we,[l(x,{icon:"ArrowLeft",link:"",onClick:e[0]||(e[0]=t=>v.value=null)},{default:d(()=>[...e[11]||(e[11]=[c("返回列表",-1)])]),_:1})]),s("div",he,[s("div",ke,[s("h2",Ve,a(o.value.title),1),s("div",Ce,[s("span",null,a(o.value.sender),1),s("span",null,a(o.value.time),1)])]),l(U,{size:"small",type:K(o.value.type),class:"shrink-0"},{default:d(()=>[c(a(G(o.value.type)),1)]),_:1},8,["type"])])]),o.value.type==="chat"?(n(),i("div",Te,[s("div",ze,[(n(!0),i(z,null,N(o.value.history,(t,T)=>(n(),i("div",{key:T,class:p(["flex gap-2 md:gap-3",t.role==="me"?"flex-row-reverse":""])},[l(X,{size:32,src:t.role==="me"?"https://cube.elemecdn.com/0/88/03b0d39583f48206768a7534e55bcpng.png":"https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png",class:"flex-shrink-0"},null,8,["src"]),s("div",{class:p(["flex flex-col max-w-[80%] md:max-w-[70%]",t.role==="me"?"items-end":"items-start"])},[!t.type||t.type==="text"?(n(),i("div",{key:0,class:p(["p-2 md:p-3 rounded-lg shadow-sm text-sm break-words",t.role==="me"?"bg-blue-600 text-white rounded-tr-none":"bg-white text-gray-800 rounded-tl-none"])},a(t.text),3)):t.type==="plan_proposal"?(n(),i("div",Me,[s("div",je,[s("span",Ee,a(t.isEnterprise?"专业作业方案":"接单报价"),1),l(U,{size:"small",type:t.status==="accepted"?"success":"warning"},{default:d(()=>[c(a(t.status==="accepted"?"已接受":"待确认"),1)]),_:2},1032,["type"])]),s("div",$e,[s("div",De,[e[12]||(e[12]=s("span",{class:"text-xs text-gray-500"},"报价金额",-1)),s("span",Le,"¥"+a(t.price),1)]),s("div",Ue,[e[13]||(e[13]=s("span",{class:"text-xs text-gray-500"},"预计工期",-1)),s("span",We,a(t.duration),1)]),t.isEnterprise?(n(),i("div",qe,[s("div",Ne,[e[14]||(e[14]=s("span",{class:"font-bold"},"飞手：",-1)),c(a(t.pilots||"未指定"),1)]),s("div",null,[e[15]||(e[15]=s("span",{class:"font-bold"},"设备：",-1)),c(a(t.drones||"未指定"),1)])])):t.deviceText?(n(),i("div",Pe,[s("div",null,[e[16]||(e[16]=s("span",{class:"font-bold"},"设备：",-1)),c(a(t.deviceText),1)])])):f("",!0),s("div",Ae,a(t.description),1),S.value&&t.status==="pending"?(n(),i("div",Be,[l(x,{type:"primary",size:"small",class:"w-full",onClick:Je=>Q(o.value,T)},{default:d(()=>[...e[17]||(e[17]=[c("接受方案并支付",-1)])]),_:1},8,["onClick"])])):f("",!0)])])):f("",!0),s("span",Re,a(t.time),1)],2)],2))),128))]),s("div",Fe,[F.value?(n(),q(Y,{key:0,content:"发起报价方案",placement:"top"},{default:d(()=>[l(x,{type:"success",icon:P(re),circle:"",class:"shrink-0",onClick:J},null,8,["icon"])]),_:1})):f("",!0),l(k,{modelValue:y.value,"onUpdate:modelValue":e[1]||(e[1]=t=>y.value=t),placeholder:"输入消息...",onKeyup:ie(L,["enter"]),class:"flex-1"},null,8,["modelValue"]),l(x,{type:"primary",onClick:L,class:"shrink-0"},{default:d(()=>[...e[18]||(e[18]=[c("发送",-1)])]),_:1})])])):(n(),i("div",Se,[s("div",Ie,a(o.value.content),1),o.value.action?(n(),i("div",Ke,[l(x,{type:"primary",class:"w-full md:w-auto",onClick:e[2]||(e[2]=t=>H(o.value.action))},{default:d(()=>[c(a(o.value.actionText),1)]),_:1})])):f("",!0)]))],64)):(n(),i("div",Ge,[l(Z,{size:64,class:"mb-4 text-gray-200"},{default:d(()=>[l(P(ue))]),_:1}),e[19]||(e[19]=s("p",null,"选择一条消息查看详情",-1))]))],2)],2)],2),l(te,{modelValue:_.value,"onUpdate:modelValue":e[7]||(e[7]=t=>_.value=t),title:"发起报价方案",width:h.value?"90%":"500px","append-to-body":"",class:"rounded-xl"},{footer:d(()=>[l(x,{onClick:e[6]||(e[6]=t=>_.value=!1)},{default:d(()=>[...e[20]||(e[20]=[c("取消",-1)])]),_:1}),l(x,{type:"primary",onClick:O},{default:d(()=>[...e[21]||(e[21]=[c("发送方案",-1)])]),_:1})]),default:d(()=>[l(ee,{model:r.value,"label-width":"80px"},{default:d(()=>[l(C,{label:"报价金额"},{default:d(()=>[l(k,{modelValue:r.value.price,"onUpdate:modelValue":e[3]||(e[3]=t=>r.value.price=t),placeholder:"例如：¥5,000"},null,8,["modelValue"])]),_:1}),l(C,{label:"预计工期"},{default:d(()=>[l(k,{modelValue:r.value.duration,"onUpdate:modelValue":e[4]||(e[4]=t=>r.value.duration=t),placeholder:"例如：3天"},null,8,["modelValue"])]),_:1}),l(C,{label:"方案说明"},{default:d(()=>[l(k,{modelValue:r.value.description,"onUpdate:modelValue":e[5]||(e[5]=t=>r.value.description=t),type:"textarea",rows:"3",placeholder:"请简要描述服务内容和交付标准"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","width"])],2)}}};export{Qe as default};
