import{u as be,a1 as X,r as M,c as x,d as _e,C as ge,e as p,h as a,i as t,g as Y,t as c,n as L,w as l,j as v,p as u,q as i,F as S,k as Z,f as W,s as f,E as _}from"./index-U0bzlslD.js";const Ve={class:"max-w-4xl"},ke={class:"flex items-center justify-between mb-6"},we={class:"text-sm text-gray-500 mt-1"},Pe={class:"text-xs font-medium"},Ue={class:"flex items-center gap-4"},Ne={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"},he={class:"flex justify-between items-center mb-2"},Ce={class:"text-sm font-medium text-gray-800"},Te={class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4"},je={class:"text-base font-semibold text-gray-800 mb-1"},Be={class:"space-y-1 text-xs"},De={class:"space-y-1 text-xs text-gray-700"},Le={class:"font-semibold text-gray-900"},ze={class:"font-semibold text-gray-900"},Se={class:"font-semibold text-gray-900"},Ae={class:"mb-4 flex items-center justify-between"},Fe={class:"flex items-center gap-2"},qe={key:0,class:"text-[11px] text-gray-400"},Ee={key:1,class:"text-[11px] text-gray-400"},Ie={key:2,class:"text-[11px] text-gray-400"},$e={key:3,class:"text-[11px] text-gray-400"},Me={class:"space-y-3"},We={class:"flex items-center justify-between bg-orange-50 border border-orange-100 rounded-lg px-3 py-2"},He={class:"flex items-center justify-between bg-blue-50 border border-blue-100 rounded-lg px-3 py-2"},Oe={class:"text-xs text-blue-500"},Re={key:0},Ge={key:1},Je={key:2},Ke={key:3},Qe={key:0},Xe={key:1},Ye={key:2},Ze={key:2,class:"mb-4"},et={class:"hidden md:block"},tt={class:"md:hidden space-y-3"},lt={class:"flex justify-between items-start mb-1"},at={class:"font-medium text-gray-900 text-xs line-clamp-2"},st={class:"text-[11px] text-gray-500 mb-1"},ot={class:"flex justify-between items-center text-[11px] text-gray-500"},nt={key:3,class:"text-xs text-gray-400 mb-4"},rt={class:"flex justify-between items-center py-2"},dt={class:"flex justify-between items-center py-2"},ut={class:"mt-6 flex justify-end"},mt={__name:"UserProfile",setup(it){const{user:s,activeIdentity:k,updateProfile:ee,applyToBProvider:te}=be(),{state:A}=_e(),n=X({nickname:"",phone:"",bio:"",companyName:"",companyType:"",contactPerson:"",companyPhone:"",companyDesc:"",services:[]}),C=M(!1),d=X({companyName:"",type:"",contactName:"",contactPhone:"",remark:""}),w=M([]),P=M([]),T=x(()=>{var r;return k.value==="provider"&&((r=s.value)==null?void 0:r.role)==="b-user"}),F=x(()=>{var r;return k.value==="provider"&&((r=s.value)==null?void 0:r.role)==="c-user"}),le=x(()=>T.value?"管理企业信息与服务能力":F.value?"管理个人资料与飞手认证状态":"管理个人资料与安全设置"),V=x(()=>!s.value||!s.value.upgradeToB?"":s.value.upgradeToB.status||""),b=x(()=>s.value&&s.value.certificationStatus||"none"),ae=x(()=>!s.value||!s.value.providerLevel?"未开通服务方":s.value.providerLevel==="lv2"?"认证飞手":s.value.providerLevel==="lv3"||s.value.providerLevel==="lv4"?"专业服务商":"基础飞手"),se=x(()=>b.value==="pending"?"认证审核中":b.value==="approved"?"已通过飞手认证":b.value==="rejected"?"认证被驳回，待重新提交":"尚未发起飞手认证"),oe=x(()=>b.value==="approved"?"text-green-600":b.value==="pending"?"text-orange-500":b.value==="rejected"?"text-red-500":"text-gray-400"),H=x(()=>s.value?T.value?"服务方 · B端后台":F.value?"服务方 · C端后台":k.value&&k.value.startsWith("requester")?"需求方 · C端后台":"":""),ne=x(()=>T.value?"inline-flex items-center px-3 py-1 rounded-full text-xs bg-blue-50 text-blue-600 border border-blue-100":F.value?"inline-flex items-center px-3 py-1 rounded-full text-xs bg-green-50 text-green-600 border border-green-100":k.value&&k.value.startsWith("requester")?"inline-flex items-center px-3 py-1 rounded-full text-xs bg-orange-50 text-orange-600 border border-orange-100":"inline-flex items-center px-3 py-1 rounded-full text-xs bg-gray-50 text-gray-500 border border-gray-100"),re=x(()=>s.value?!!s.value.idVerified:!1),q=x(()=>!A.value||!Array.isArray(A.value.tasks)?[]:A.value.tasks.slice(0,3)),O=r=>({沟通中:"info",已通过:"success",已拒绝:"danger",已取消:"info",已完成:"success"})[r]||"info",de=x(()=>s.value&&s.value.avatar?s.value.avatar:"https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?ixlib=rb-1.2.1&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80"),ue=()=>{s.value&&(n.nickname=s.value.nickname||s.value.username||"",n.phone=s.value.phone||"",n.bio=s.value.bio||"",n.companyName=s.value.companyName||"",n.companyType=s.value.type||"",n.contactPerson=s.value.contactPerson||"",n.companyPhone=s.value.phone||"",n.companyDesc=s.value.companyDesc||"",n.services=Array.isArray(s.value.services)?s.value.services.map(r=>({...r})):[])};ge(s,()=>{ue()},{immediate:!0});const ie=()=>{n.services.push({name:"",price:"",desc:""})},pe=r=>{n.services.splice(r,1)},me=()=>{if(!s.value){_.error("请先登录");return}const r={nickname:n.nickname,bio:n.bio};T.value&&(r.companyName=n.companyName,r.type=n.companyType,r.contactPerson=n.contactPerson,r.phone=n.companyPhone,r.companyDesc=n.companyDesc,r.services=n.services.map(E=>({...E})));const e=ee(r);if(!e.success){_.error(e.message||"保存失败");return}_.success("已保存账号设置")},ce=r=>{if(typeof window>"u")return;const e=new CustomEvent("open-identity-dialog",{detail:{mode:r,applicationOnly:!0}});window.dispatchEvent(e)},ve=()=>{if(!s.value){_.error("请先登录");return}if(V.value==="pending"){_.info("升级申请审核中，请耐心等待");return}d.companyName=n.companyName||"",d.type=n.companyType||"",d.contactName=n.contactPerson||"",d.contactPhone=n.companyPhone||"",d.remark="",w.value=[],P.value=[],C.value=!0},fe=()=>{if(!d.companyName||!d.contactName||!d.contactPhone){_.error("请填写完整公司信息");return}if(!w.value||w.value.length<2){_.error("请上传飞手证书正反面");return}if(!P.value||P.value.length<2){_.error("请上传保险凭证正反面");return}const r=te({companyName:d.companyName,type:d.type,contactName:d.contactName,contactPhone:d.contactPhone,remark:d.remark,pilotLicenseDocs:w.value.map(e=>({name:e.name,url:e.url||""})),insuranceDocs:P.value.map(e=>({name:e.name,url:e.url||""}))});if(!r.success){_.error(r.message||"提交失败");return}_.success("已提交升级为B端服务商申请"),C.value=!1};return(r,e)=>{const E=v("el-avatar"),g=v("el-button"),m=v("el-form-item"),y=v("el-input"),U=v("el-col"),I=v("el-row"),j=v("el-divider"),N=v("el-option"),R=v("el-select"),B=v("el-card"),D=v("el-table-column"),z=v("el-tag"),ye=v("el-table"),G=v("el-form"),J=v("Plus"),K=v("el-icon"),Q=v("el-upload"),xe=v("el-dialog");return u(),p("div",Ve,[a("div",ke,[a("div",null,[e[18]||(e[18]=a("h2",{class:"text-xl font-bold text-gray-800"},"账号设置",-1)),a("p",we,c(le.value),1)]),H.value?(u(),p("div",{key:0,class:L(ne.value)},[a("span",Pe,c(H.value),1)],2)):Y("",!0)]),t(B,{shadow:"never"},{default:l(()=>[t(G,{"label-position":"top"},{default:l(()=>[t(m,{label:"头像"},{default:l(()=>[a("div",Ue,[t(E,{size:64,src:de.value},null,8,["src"]),t(g,{size:"small"},{default:l(()=>[...e[19]||(e[19]=[i("更换头像",-1)])]),_:1})])]),_:1}),t(I,{gutter:20},{default:l(()=>[t(U,{xs:24,sm:12},{default:l(()=>[t(m,{label:"昵称"},{default:l(()=>[t(y,{modelValue:n.nickname,"onUpdate:modelValue":e[0]||(e[0]=o=>n.nickname=o)},null,8,["modelValue"])]),_:1})]),_:1}),t(U,{xs:24,sm:12},{default:l(()=>[t(m,{label:"手机号"},{default:l(()=>[t(y,{modelValue:n.phone,"onUpdate:modelValue":e[1]||(e[1]=o=>n.phone=o),disabled:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(m,{label:"个人简介"},{default:l(()=>[t(y,{modelValue:n.bio,"onUpdate:modelValue":e[2]||(e[2]=o=>n.bio=o),type:"textarea",rows:"3"},null,8,["modelValue"])]),_:1}),T.value?(u(),p(S,{key:0},[t(j,null,{default:l(()=>[...e[20]||(e[20]=[i("公司信息",-1)])]),_:1}),t(I,{gutter:20},{default:l(()=>[t(U,{xs:24,sm:12},{default:l(()=>[t(m,{label:"公司名称"},{default:l(()=>[t(y,{modelValue:n.companyName,"onUpdate:modelValue":e[3]||(e[3]=o=>n.companyName=o),placeholder:"如：某某航拍科技有限公司"},null,8,["modelValue"])]),_:1})]),_:1}),t(U,{xs:24,sm:12},{default:l(()=>[t(m,{label:"公司类型"},{default:l(()=>[t(R,{modelValue:n.companyType,"onUpdate:modelValue":e[4]||(e[4]=o=>n.companyType=o),placeholder:"选择主营类型"},{default:l(()=>[t(N,{label:"航拍服务商",value:"photography"}),t(N,{label:"保险机构",value:"insurance"}),t(N,{label:"综合解决方案",value:"general"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(I,{gutter:20},{default:l(()=>[t(U,{xs:24,sm:12},{default:l(()=>[t(m,{label:"联系人"},{default:l(()=>[t(y,{modelValue:n.contactPerson,"onUpdate:modelValue":e[5]||(e[5]=o=>n.contactPerson=o),placeholder:"联系人姓名"},null,8,["modelValue"])]),_:1})]),_:1}),t(U,{xs:24,sm:12},{default:l(()=>[t(m,{label:"联系电话"},{default:l(()=>[t(y,{modelValue:n.companyPhone,"onUpdate:modelValue":e[6]||(e[6]=o=>n.companyPhone=o),placeholder:"手机号或座机"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(m,{label:"公司简介"},{default:l(()=>[t(y,{modelValue:n.companyDesc,"onUpdate:modelValue":e[7]||(e[7]=o=>n.companyDesc=o),type:"textarea",rows:"3",placeholder:"简要介绍业务与优势"},null,8,["modelValue"])]),_:1}),t(j,null,{default:l(()=>[...e[21]||(e[21]=[i("服务能力",-1)])]),_:1}),a("div",Ne,[(u(!0),p(S,null,Z(n.services,(o,$)=>(u(),W(B,{key:$,class:"border border-blue-100",shadow:"never"},{default:l(()=>[a("div",he,[a("span",Ce,"服务 "+c($+1),1),t(g,{type:"danger",text:"",size:"small",onClick:h=>pe($)},{default:l(()=>[...e[22]||(e[22]=[i("删除",-1)])]),_:1},8,["onClick"])]),t(m,{label:"服务名称"},{default:l(()=>[t(y,{modelValue:o.name,"onUpdate:modelValue":h=>o.name=h,placeholder:"如：低空物流配送方案"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(m,{label:"价格"},{default:l(()=>[t(y,{modelValue:o.price,"onUpdate:modelValue":h=>o.price=h,placeholder:"如：¥5000起 / ¥8000/天"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(m,{label:"服务描述"},{default:l(()=>[t(y,{modelValue:o.desc,"onUpdate:modelValue":h=>o.desc=h,type:"textarea",rows:"2",placeholder:"简要说明服务内容和适用场景"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024))),128)),a("div",{class:"border border-dashed border-blue-200 rounded-xl flex items-center justify-center text-blue-500 cursor-pointer hover:bg-blue-50 transition",onClick:ie},[...e[23]||(e[23]=[a("div",{class:"text-center px-4 py-8"},[a("div",{class:"text-sm font-medium mb-1"},"新增服务卡片"),a("div",{class:"text-xs text-blue-400"},"为需求方展示更多业务能力")],-1)])])])],64)):(u(),p(S,{key:1},[t(j,null,{default:l(()=>[...e[24]||(e[24]=[i("飞手认证状态",-1)])]),_:1}),a("div",Te,[t(B,{class:"border border-orange-100",shadow:"never"},{default:l(()=>[e[25]||(e[25]=a("div",{class:"text-xs text-gray-500 mb-1"},"当前等级",-1)),a("div",je,c(ae.value),1),a("div",{class:L(["text-[11px]",oe.value])},c(se.value),3)]),_:1}),t(B,{class:"border border-green-100",shadow:"never"},{default:l(()=>[e[26]||(e[26]=a("div",{class:"text-xs text-gray-500 mb-1"},"飞手资质",-1)),a("div",Be,[a("div",{class:L(f(s)&&f(s).idVerified?"text-green-600":"text-gray-400")},c(f(s)&&f(s).idVerified?"已完成实名认证":"未实名"),3),a("div",{class:L(f(s)&&f(s).pilotLicense?"text-green-600":"text-red-500")},c(f(s)&&f(s).pilotLicense?"已上传飞手证书":"暂未上传飞手证书"),3),a("div",{class:L(f(s)&&f(s).insuranceActive?"text-green-600":"text-red-500")},c(f(s)&&f(s).insuranceActive?"已配置飞手保险":"尚未配置飞手保险"),3)])]),_:1}),t(B,{class:"border border-blue-100",shadow:"never"},{default:l(()=>[e[32]||(e[32]=a("div",{class:"text-xs text-gray-500 mb-1"},"累计表现",-1)),a("div",De,[a("div",null,[e[27]||(e[27]=i("飞行时长：",-1)),a("span",Le,c(f(s)&&f(s).flightHours||0),1),e[28]||(e[28]=i(" 小时",-1))]),a("div",null,[e[29]||(e[29]=i("接单次数：",-1)),a("span",ze,c(f(s)&&f(s).ordersCount||0),1),e[30]||(e[30]=i(" 次",-1))]),a("div",null,[e[31]||(e[31]=i("信用分：",-1)),a("span",Se,c(f(s)&&f(s).creditScore||0),1)])])]),_:1})]),a("div",Ae,[a("div",Fe,[e[33]||(e[33]=a("div",{class:"text-sm font-medium text-gray-800"},"身份与升级",-1)),b.value==="none"?(u(),p("span",qe,"完成飞手认证后可解锁更多任务和权益")):b.value==="pending"?(u(),p("span",Ee,"认证审核通过后，将提升为认证飞手等级")):b.value==="approved"?(u(),p("span",Ie,"已认证，可继续完善资料和申请B端升级")):b.value==="rejected"?(u(),p("span",$e,"认证被驳回，可重新提交补充资料")):Y("",!0)])]),a("div",Me,[a("div",We,[e[34]||(e[34]=a("div",null,[a("div",{class:"text-sm font-medium text-orange-700"},"认证飞手"),a("div",{class:"text-xs text-orange-500"},"提升信用，解锁更多接单机会")],-1)),t(g,{size:"small",type:"warning",plain:"",onClick:e[8]||(e[8]=o=>ce("provider"))},{default:l(()=>[i(c(b.value==="approved"?"已认证":"去升级"),1)]),_:1})]),a("div",He,[a("div",null,[e[35]||(e[35]=a("div",{class:"text-sm font-medium text-blue-700"},"升级为B端服务商",-1)),a("div",Oe,[V.value==="pending"?(u(),p("span",Re,"申请已提交，等待管理端审核")):V.value==="approved"?(u(),p("span",Ge,"已通过审核，可使用服务方身份接入B端工作台")):V.value==="rejected"?(u(),p("span",Je,"上次申请已被驳回，可重新提交完善资料")):(u(),p("span",Ke,"成为企业服务方，拥有专属工作台"))])]),t(g,{size:"small",type:"primary",plain:"",onClick:ve,disabled:V.value==="pending"},{default:l(()=>[V.value==="pending"?(u(),p("span",Qe,"审核中")):V.value==="approved"?(u(),p("span",Xe,"已升级")):(u(),p("span",Ye,"申请升级"))]),_:1},8,["disabled"])])])],64)),t(j,null,{default:l(()=>[...e[36]||(e[36]=[i("最近接单记录",-1)])]),_:1}),q.value.length?(u(),p("div",Ze,[a("div",et,[t(ye,{data:q.value,size:"small",class:"w-full"},{default:l(()=>[t(D,{prop:"title",label:"任务名称","min-width":"180"}),t(D,{prop:"requester",label:"需求方",width:"150"}),t(D,{prop:"price",label:"成交价",width:"120"}),t(D,{prop:"status",label:"状态",width:"120"},{default:l(({row:o})=>[t(z,{type:O(o.status),size:"small"},{default:l(()=>[i(c(o.status),1)]),_:2},1032,["type"])]),_:1}),t(D,{prop:"deadline",label:"截止日期",width:"150"})]),_:1},8,["data"])]),a("div",tt,[(u(!0),p(S,null,Z(q.value,o=>(u(),p("div",{key:o.id,class:"bg-gray-50 rounded-xl p-3 border border-gray-100"},[a("div",lt,[a("div",at,c(o.title),1),t(z,{type:O(o.status),size:"small"},{default:l(()=>[i(c(o.status),1)]),_:2},1032,["type"])]),a("div",st," 需求方："+c(o.requester),1),a("div",ot,[a("span",null,"成交价："+c(o.price),1),a("span",null,"截止："+c(o.deadline),1)])]))),128))])])):(u(),p("div",nt," 暂无接单记录，可前往任务大厅开始接单。 ")),t(j,null,{default:l(()=>[...e[37]||(e[37]=[i("安全设置",-1)])]),_:1}),a("div",rt,[e[39]||(e[39]=a("div",null,[a("div",{class:"font-medium text-gray-700"},"登录密码"),a("div",{class:"text-xs text-gray-400"},"定期修改密码可以保护账号安全")],-1)),t(g,{link:"",type:"primary"},{default:l(()=>[...e[38]||(e[38]=[i("修改",-1)])]),_:1})]),a("div",dt,[e[42]||(e[42]=a("div",null,[a("div",{class:"font-medium text-gray-700"},"实名认证"),a("div",{class:"text-xs text-gray-400"},"认证信息仅用于保障账号安全")],-1)),re.value?(u(),W(z,{key:0,type:"success",size:"small"},{default:l(()=>[...e[40]||(e[40]=[i("已认证",-1)])]),_:1})):(u(),W(z,{key:1,type:"info",size:"small"},{default:l(()=>[...e[41]||(e[41]=[i("未认证",-1)])]),_:1}))]),a("div",ut,[t(g,{type:"primary",onClick:me},{default:l(()=>[...e[43]||(e[43]=[i("保存修改",-1)])]),_:1})])]),_:1})]),_:1}),t(xe,{modelValue:C.value,"onUpdate:modelValue":e[17]||(e[17]=o=>C.value=o),title:"申请升级为B端服务商",width:"480px"},{footer:l(()=>[t(g,{onClick:e[16]||(e[16]=o=>C.value=!1)},{default:l(()=>[...e[44]||(e[44]=[i("取消",-1)])]),_:1}),t(g,{type:"primary",onClick:fe},{default:l(()=>[...e[45]||(e[45]=[i("提交申请",-1)])]),_:1})]),default:l(()=>[t(G,{model:d,"label-width":"90px"},{default:l(()=>[t(m,{label:"公司名称"},{default:l(()=>[t(y,{modelValue:d.companyName,"onUpdate:modelValue":e[9]||(e[9]=o=>d.companyName=o),placeholder:"如：某某科技有限公司"},null,8,["modelValue"])]),_:1}),t(m,{label:"主营类型"},{default:l(()=>[t(R,{modelValue:d.type,"onUpdate:modelValue":e[10]||(e[10]=o=>d.type=o),placeholder:"选择企业类型"},{default:l(()=>[t(N,{label:"航拍服务商",value:"photography"}),t(N,{label:"保险机构",value:"insurance"}),t(N,{label:"综合解决方案",value:"general"})]),_:1},8,["modelValue"])]),_:1}),t(m,{label:"联系人"},{default:l(()=>[t(y,{modelValue:d.contactName,"onUpdate:modelValue":e[11]||(e[11]=o=>d.contactName=o)},null,8,["modelValue"])]),_:1}),t(m,{label:"联系电话"},{default:l(()=>[t(y,{modelValue:d.contactPhone,"onUpdate:modelValue":e[12]||(e[12]=o=>d.contactPhone=o)},null,8,["modelValue"])]),_:1}),t(m,{label:"飞手证书"},{default:l(()=>[t(Q,{action:"#","list-type":"picture-card","auto-upload":!1,limit:2,"file-list":w.value,"onUpdate:fileList":e[13]||(e[13]=o=>w.value=o)},{default:l(()=>[t(K,null,{default:l(()=>[t(J)]),_:1})]),_:1},8,["file-list"])]),_:1}),t(m,{label:"保险凭证"},{default:l(()=>[t(Q,{action:"#","list-type":"picture-card","auto-upload":!1,limit:2,"file-list":P.value,"onUpdate:fileList":e[14]||(e[14]=o=>P.value=o)},{default:l(()=>[t(K,null,{default:l(()=>[t(J)]),_:1})]),_:1},8,["file-list"])]),_:1}),t(m,{label:"补充说明"},{default:l(()=>[t(y,{modelValue:d.remark,"onUpdate:modelValue":e[15]||(e[15]=o=>d.remark=o),type:"textarea",rows:"3",placeholder:"可简单说明业务场景与优势"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}};export{mt as default};
